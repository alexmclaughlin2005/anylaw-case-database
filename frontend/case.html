<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Detail - AnyLaw Database</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="index.html">AnyLaw Database Navigator</a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="search.html">Search Cases</a></li>
            </ul>
        </div>
    </nav>
    
    <main class="main-content">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html">Dashboard</a> ¬ª <a href="search.html">Search</a> ¬ª <span id="caseTitle">Case</span>
            </div>
            
            <div id="loading" class="loading">Loading case details...</div>
            
            <div id="caseContent" style="display: none;">
                <div class="case-header">
                    <h1 id="caseTitleFull"></h1>
                    <div class="case-meta-grid">
                        <div class="meta-item">
                            <strong>üìç Jurisdiction:</strong>
                            <span id="caseJurisdiction"></span>
                        </div>
                        <div class="meta-item">
                            <strong>üìÖ Date:</strong>
                            <span id="caseDate"></span>
                        </div>
                        <div class="meta-item">
                            <strong>üìã Docket:</strong>
                            <span id="caseDocket"></span>
                        </div>
                        <div class="meta-item">
                            <strong>üìè Length:</strong>
                            <span id="caseLength"></span>
                        </div>
                    </div>
                </div>
                
                <div class="case-sections">
                    <div class="section">
                        <h2>üìñ How to Cite This Case</h2>
                        <p class="section-description">Use these citations when referencing this case:</p>
                        <div id="caseCitations" class="citations-list"></div>
                    </div>
                    
                    <div class="section" id="extractedCitationsSection" style="display: none;">
                        <h2>üîó Cases Cited in This Opinion</h2>
                        <p class="section-description">
                            This opinion cites <span id="totalCitationsFound">0</span> cases. 
                            <span id="citationsInDbCount">0</span> are available in this database:
                        </p>
                        <div id="loadingCitations" class="loading-small">Extracting citations from opinion text...</div>
                        <div id="extractedCitations" class="citations-list" style="display: none;"></div>
                        <div id="noCitationsFound" class="info-message" style="display: none;">
                            No cited cases found in this database sample. 
                            The cases cited may be in the full 8.5M database.
                        </div>
                    </div>
                    
                    <div class="section" id="categoriesSection">
                        <h2>üè∑Ô∏è Categories</h2>
                        <div id="caseCategories" class="tags-list"></div>
                    </div>
                    
                    <div class="section" id="judgesSection">
                        <h2>‚öñÔ∏è Judges</h2>
                        <div id="caseJudges" class="text-content"></div>
                    </div>
                    
                    <div class="section" id="attorneysSection">
                        <h2>üëî Attorneys</h2>
                        <div id="caseAttorneys" class="text-content"></div>
                    </div>
                    
                    <div class="section">
                        <h2>üìÑ Full Opinion</h2>
                        <div class="body-controls">
                            <button onclick="toggleBody()" id="toggleBodyBtn" class="btn-secondary">Show Full Text</button>
                            <span class="word-count" id="wordCount"></span>
                        </div>
                        <div id="caseBody" class="case-body" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <div id="errorMessage" class="error" style="display: none;">
                Case not found
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 AnyLaw - Lexsphere Case Database Navigator</p>
            <p>Database contains 8.5M+ cases from 200+ jurisdictions</p>
        </div>
    </footer>
    
    <script src="env.js"></script>
    <script src="static/js/api.js"></script>
    <script src="static/js/main.js"></script>
    <script>
// Get document ID from URL parameter
const urlParams = new URLSearchParams(window.location.search);
const docId = urlParams.get('id');

let caseData = null;
let bodyVisible = false;

async function loadCase() {
    if (!docId) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('errorMessage').textContent = 'No case ID provided';
        return;
    }
    
    try {
        caseData = await api.getDocument(docId);
        displayCase();
    } catch (error) {
        console.error('Error loading case:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'block';
    }
}

function displayCase() {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('caseContent').style.display = 'block';
    
    const doc = caseData.document;
    
    // Title
    const title = doc.title || 'Untitled Case';
    document.getElementById('caseTitle').textContent = title;
    document.getElementById('caseTitleFull').textContent = doc.full_title || title;
    
    // Metadata
    document.getElementById('caseJurisdiction').textContent = doc.jurisdiction || 'Unknown';
    document.getElementById('caseDate').textContent = utils.formatDate(doc.date);
    document.getElementById('caseDocket').textContent = doc.docket || 'N/A';
    
    const lengthKB = doc.body_length ? (doc.body_length / 1024).toFixed(1) : 'N/A';
    document.getElementById('caseLength').textContent = 
        doc.body_length ? `${lengthKB} KB (${utils.estimateWords(doc.body_length).toLocaleString()} words)` : 'N/A';
    
    // Citations for THIS case (how to cite it)
    if (doc.citedas && doc.citedas.length > 0) {
        document.getElementById('caseCitations').innerHTML = 
            doc.citedas.map(cite => 
                `<span class="citation-badge">üìå ${escapeHtml(cite)}</span>`
            ).join('');
    } else {
        document.getElementById('caseCitations').textContent = 'No citations available';
    }
    
    // Extracted citations (cases THIS case cites)
    if (caseData.extracted_citations) {
        const extracted = caseData.extracted_citations;
        document.getElementById('extractedCitationsSection').style.display = 'block';
        document.getElementById('totalCitationsFound').textContent = extracted.total_found.toLocaleString();
        document.getElementById('citationsInDbCount').textContent = extracted.in_database.length;
        
        document.getElementById('loadingCitations').style.display = 'none';
        
        if (extracted.in_database.length > 0) {
            document.getElementById('extractedCitations').style.display = 'flex';
            document.getElementById('extractedCitations').innerHTML = 
                extracted.in_database.map(item => 
                    `<span class="citation-badge clickable" onclick="navigateToCase('${item.id}', '${escapeHtml(item.citation)}')" 
                           title="Click to view: ${escapeHtml(item.title)}">
                        üîó ${escapeHtml(item.citation)}
                     </span>`
                ).join('');
        } else {
            document.getElementById('noCitationsFound').style.display = 'block';
        }
    }
    
    // Categories
    if (doc.category && doc.category.length > 0) {
        document.getElementById('caseCategories').innerHTML = 
            doc.category.map(cat => `<span class="tag">${escapeHtml(cat)}</span>`).join('');
    } else {
        document.getElementById('categoriesSection').style.display = 'none';
    }
    
    // Judges
    if (doc.judges) {
        document.getElementById('caseJudges').textContent = doc.judges;
    } else {
        document.getElementById('judgesSection').style.display = 'none';
    }
    
    // Attorneys
    if (doc.attorneys) {
        document.getElementById('caseAttorneys').textContent = doc.attorneys;
    } else {
        document.getElementById('attorneysSection').style.display = 'none';
    }
    
    // Word count for body
    if (doc.body) {
        const wordCount = utils.estimateWords(doc.body_length);
        document.getElementById('wordCount').textContent = `${wordCount.toLocaleString()} words`;
    }
}

function toggleBody() {
    const bodyDiv = document.getElementById('caseBody');
    const btn = document.getElementById('toggleBodyBtn');
    
    if (!bodyVisible) {
        bodyDiv.textContent = caseData.document.body || 'No body text available';
        bodyDiv.style.display = 'block';
        btn.textContent = 'Hide Full Text';
        bodyVisible = true;
    } else {
        bodyDiv.style.display = 'none';
        btn.textContent = 'Show Full Text';
        bodyVisible = false;
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function navigateToCase(caseId, citation) {
    // Create status message
    const section = document.getElementById('extractedCitationsSection');
    const statusMsg = document.createElement('div');
    statusMsg.className = 'citation-lookup-status success';
    statusMsg.innerHTML = `‚úì Opening case cited as "${escapeHtml(citation)}"...<br>Redirecting...`;
    section.prepend(statusMsg);
    
    // Navigate after short delay
    setTimeout(() => {
        window.location.href = `case.html?id=${caseId}`;
    }, 800);
}

// Load case on page load
loadCase();
    </script>
</body>
</html>

